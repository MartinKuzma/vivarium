name: yaml_test_world

script_library:
  script_x:
    id: script_x
    kind: lua
    script: |
      local speed = 5
      local distance_traveled = 0
      
      function update(current_time, msgs)
          for _, msg in ipairs(msgs) do
              if msg.kind == "accelerate" then
                  speed = speed + msg.content.boost
              end
          end
          
          distance_traveled = distance_traveled + speed
          world.record_metric("distance", distance_traveled)
      end
      
      function get_state()
          return {
              speed = speed,
              distance_traveled = distance_traveled
          }
      end
      
      function set_state(state)
          speed = state.speed
          distance_traveled = state.distance_traveled
      end
  
  script_y:
    id: script_y
    kind: lua
    script: |
      local temperature = 20
      local status = "idle"
      
      function update(current_time, msgs)
          for _, msg in ipairs(msgs) do
              if msg.kind == "heat" then
                  temperature = temperature + msg.content.degrees
              elseif msg.kind == "cool" then
                  temperature = temperature - msg.content.degrees
              end
          end
          
          if temperature > 50 then
              status = "overheating"
          elseif temperature < 0 then
              status = "frozen"
          else
              status = "normal"
          end
          
          world.record_metric("temperature", temperature)
      end
      
      function get_state()
          return {
              temperature = temperature,
              status = status
          }
      end
      
      function set_state(state)
          temperature = state.temperature
          status = state.status
      end

entities:
  - id: entity_x
    script_id: script_x
    initial_state:
      speed: 5
      distance_traveled: 0
  
  - id: entity_y
    script_id: script_y
    initial_state:
      temperature: 20
      status: idle
